<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آب و هوای واقعی | World Weather + Gemini AI</title>
    
    <!-- فونت فارسی وزیرمتن -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/misc/Farsi-Digits/Vazirmatn-FD-font-face.css" rel="stylesheet" type="text/css" />
    
    <!-- آیکون‌ها -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- استایل‌ها با Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Vazirmatn FD', sans-serif;
            transition: background 1s ease;
            margin: 0;
            padding: 0;
        }

        .bg-sunny { background: linear-gradient(135deg, #00b4db, #0083b0); }
        .bg-cloudy { background: linear-gradient(135deg, #5d4157, #a8caba); }
        .bg-rainy { background: linear-gradient(135deg, #203a43, #2c5364); }
        .bg-snowy { background: linear-gradient(135deg, #e6dada, #274046); }
        .bg-night { background: linear-gradient(135deg, #141e30, #243b55); }
        .bg-mist { background: linear-gradient(135deg, #606c88, #3f4c6b); }

        .glass-panel {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 40px 0 rgba(0, 0, 0, 0.2);
        }

        .loader {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #ffffff;
            width: 24px;
            height: 24px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .gemini-btn {
            background: linear-gradient(90deg, #6366f1, #a855f7, #ec4899);
            background-size: 200% auto;
            transition: 0.5s;
        }
        .gemini-btn:hover {
            background-position: right center;
            transform: scale(1.05);
        }

        .custom-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .custom-input:focus {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .sun-animate {
            animation: rotate-slow 15s linear infinite;
        }
        @keyframes rotate-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-sunny min-h-screen flex items-center justify-center p-4 text-white transition-all duration-1000" id="mainBody">

    <div class="glass-panel rounded-[2rem] p-8 w-full max-w-md relative transition-all duration-500 shadow-2xl">
        
        <div class="flex flex-col gap-6 mb-8">
            <h1 class="text-2xl font-black text-center mb-2 tracking-tight drop-shadow-lg text-white">هواشناسی هوشمند</h1>
            
            <div class="relative w-full">
                <input type="text" id="cityInput" placeholder="نام شهر (انگلیسی)..." 
                    class="custom-input w-full p-4 pr-12 rounded-2xl placeholder-white/50 text-white outline-none text-center text-lg">
                <button onclick="fetchWeather()" class="absolute left-3 top-1/2 -translate-y-1/2 p-2 hover:bg-white/20 rounded-xl transition">
                    <i data-lucide="search" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="loading" class="loader mx-auto hidden"></div>
        </div>

        <div id="weatherDisplay" class="flex flex-col items-center text-center transition-opacity duration-500">
            <div class="relative group cursor-pointer mb-4" onclick="speakWeather()">
                <div class="absolute -top-2 -right-2 bg-indigo-600 p-2 rounded-full shadow-lg border border-white/20 z-10">
                    <i data-lucide="volume-2" class="w-4 h-4 text-white"></i>
                </div>
                <div id="iconContainer" class="w-32 h-32 flex items-center justify-center transition-transform group-hover:scale-110">
                    <i id="mainIcon" data-lucide="sun" class="w-24 h-24 text-yellow-300 sun-animate"></i>
                </div>
            </div>

            <h2 id="cityName" class="text-3xl font-black mb-1 drop-shadow-md text-white">منتظر جستجو</h2>
            <p id="description" class="text-lg text-white/80 mb-6 font-medium">آماده برای دریافت اطلاعات</p>
            
            <div class="text-7xl font-black mb-8 tracking-tighter drop-shadow-2xl flex items-start">
                <span id="temp">--</span><span class="text-3xl mt-2">°</span>
            </div>

            <div class="grid grid-cols-3 gap-3 w-full mb-8">
                <div class="bg-white/10 rounded-2xl p-3 flex flex-col items-center gap-1 border border-white/5">
                    <i data-lucide="wind" class="w-5 h-5 text-blue-300"></i>
                    <span class="text-[10px] uppercase text-white/60">باد</span>
                    <span id="windSpeed" class="text-xs font-bold">--</span>
                </div>
                <div class="bg-white/10 rounded-2xl p-3 flex flex-col items-center gap-1 border border-white/5">
                    <i data-lucide="droplets" class="w-5 h-5 text-cyan-300"></i>
                    <span class="text-[10px] uppercase text-white/60">رطوبت</span>
                    <span id="humidity" class="text-xs font-bold">--</span>
                </div>
                <div class="bg-white/10 rounded-2xl p-3 flex flex-col items-center gap-1 border border-white/5">
                    <i data-lucide="thermometer" class="w-5 h-5 text-orange-300"></i>
                    <span class="text-[10px] uppercase text-white/60">احساس</span>
                    <span id="feelsLike" class="text-xs font-bold">--</span>
                </div>
            </div>

            <button onclick="askGemini()" class="gemini-btn w-full py-4 rounded-2xl flex items-center justify-center gap-3 text-white font-black text-lg mb-4 shadow-xl active:scale-95 transition-transform">
                <i data-lucide="sparkles" class="w-6 h-6 animate-pulse"></i>
                <span>تحلیل هوشمند Gemini</span>
            </button>

            <div id="aiResponseBox" class="hidden w-full bg-black/30 backdrop-blur-xl rounded-2xl p-5 text-right text-sm leading-7 border-r-4 border-indigo-400 shadow-inner">
                <p id="aiText" class="text-white/95 font-medium"></p>
            </div>
        </div>
    </div>

    <script>
        // تنظیمات اولیه
        const geminiApiKey = "AIzaSyCkmBaLmWuaqJ3PbtSmfLv7az52gMyA5XI"; 
        const weatherApiKey = "abfbc2bcdd9a5532bd6eab88413c6a56"; 

        let currentData = { city: '', temp: '--', condition: 'Clear', description: '' };

        const weatherTranslations = {
            "Clear": "آسمان صاف", "Clouds": "کمی ابری", "Rain": "بارانی", "Drizzle": "نم‌باران",
            "Thunderstorm": "طوفانی", "Snow": "برفی", "Mist": "مه‌آلود", "Fog": "مه غلیظ"
        };

        async function fetchWeather() {
            const cityInput = document.getElementById('cityInput');
            const city = cityInput.value.trim();
            if (!city) return;

            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('weatherDisplay').style.opacity = '0.5';

            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${weatherApiKey}&units=metric`);
                const data = await response.json();

                if (data.cod !== 200) throw new Error(data.message);

                currentData = {
                    city: data.name,
                    temp: Math.round(data.main.temp),
                    condition: data.weather[0].main,
                    description: weatherTranslations[data.weather[0].main] || data.weather[0].description,
                    humidity: data.main.humidity,
                    wind: Math.round(data.wind.speed * 3.6),
                    feelsLike: Math.round(data.main.feels_like)
                };

                updateUI();
            } catch (error) {
                alert("شهر پیدا نشد! نام را به انگلیسی وارد کنید (مثل: Tehran)");
            } finally {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('weatherDisplay').style.opacity = '1';
            }
        }

        function updateUI() {
            document.getElementById('cityName').innerText = currentData.city;
            document.getElementById('temp').innerText = currentData.temp;
            document.getElementById('description').innerText = currentData.description;
            document.getElementById('humidity').innerText = currentData.humidity + "%";
            document.getElementById('windSpeed').innerText = currentData.wind + " km/h";
            document.getElementById('feelsLike').innerText = currentData.feelsLike + "°";

            const icon = document.getElementById('mainIcon');
            const body = document.getElementById('mainBody');
            
            let iconName = 'sun', bgClass = 'bg-sunny', colorClass = 'text-yellow-300';

            if (currentData.condition === 'Clear') {
                iconName = 'sun'; bgClass = 'bg-sunny'; colorClass = 'text-yellow-300';
                icon.classList.add('sun-animate');
            } else if (currentData.condition === 'Clouds') {
                iconName = 'cloud'; bgClass = 'bg-cloudy'; colorClass = 'text-gray-100';
                icon.classList.remove('sun-animate');
            } else if (['Rain', 'Drizzle'].includes(currentData.condition)) {
                iconName = 'cloud-rain'; bgClass = 'bg-rainy'; colorClass = 'text-blue-300';
                icon.classList.remove('sun-animate');
            } else if (currentData.condition === 'Snow') {
                iconName = 'snowflake'; bgClass = 'bg-snowy'; colorClass = 'text-white';
                icon.classList.remove('sun-animate');
            } else {
                iconName = 'wind'; bgClass = 'bg-mist'; colorClass = 'text-gray-200';
                icon.classList.remove('sun-animate');
            }

            icon.setAttribute('data-lucide', iconName);
            icon.className = `w-24 h-24 ${colorClass} transition-all duration-700 ${currentData.condition === 'Clear' ? 'sun-animate' : ''}`;
            body.className = `min-h-screen flex items-center justify-center p-4 text-white transition-all duration-1000 ${bgClass}`;
            
            lucide.createIcons();
            document.getElementById('aiResponseBox').classList.add('hidden');
        }

        async function askGemini() {
            if (currentData.temp === '--') {
                alert("ابتدا یک شهر را جستجو کنید.");
                return;
            }

            const aiBox = document.getElementById('aiResponseBox');
            const aiText = document.getElementById('aiText');
            aiBox.classList.remove('hidden');
            aiText.innerHTML = "هوش مصنوعی در حال تحلیل وضعیت...";

            const prompt = `با توجه به دمای ${currentData.temp} درجه و وضعیت ${currentData.description} در شهر ${currentData.city}، یک پیشنهاد خیلی کوتاه و صمیمی به فارسی بده. حداکثر ۱۰ کلمه.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                aiText.innerText = data.candidates[0].content.parts[0].text;
            } catch (e) {
                aiText.innerText = "خطا در ارتباط با هوش مصنوعی. لطفاً دوباره تلاش کنید.";
            }
        }

        function speakWeather() {
            if (currentData.temp === '--') return;
            const msg = new SpeechSynthesisUtterance(`Temperature in ${currentData.city} is ${currentData.temp} degrees.`);
            window.speechSynthesis.speak(msg);
        }

        // اجرای اولیه آیکون‌ها
        window.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            document.getElementById('cityInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') fetchWeather();
            });
        });
    </script>
</body>
</html>
